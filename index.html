<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BetThat.Live</title>
    <style>
      :root {
        --brand-purple: rgb(72, 31, 168); /* updated at runtime to match video */
      }

      * {
        box-sizing: border-box;
      }

      html,
      body {
        margin: 0;
        background: var(--brand-purple);
        color: #ffffff;
        font-family: "TT Travels Next", "Helvetica Neue", Arial, sans-serif;
      }

      .screen {
        position: relative;
        height: 100vh;
        overflow: hidden;
      }

      .video-screen {
        background: var(--brand-purple);
      }

      .video {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        opacity: 0;
        visibility: hidden;
        pointer-events: none;
        transition: opacity 180ms ease-out, visibility 180ms ease-out;
        background: var(--brand-purple);
      }

      .video.active {
        opacity: 1;
        visibility: visible;
        pointer-events: auto;
      }

      .fallback {
        position: absolute;
        inset: 0;
        display: grid;
        place-items: center;
        text-align: center;
        padding: 16px;
      }

      .cta-screen {
        background: var(--brand-purple);
        display: grid;
        place-items: center;
        padding: 32px;
        text-align: center;
      }

      .cta-screen h1 {
        margin: 0;
        font-size: clamp(2.75rem, 5vw, 4rem);
        letter-spacing: 0.05em;
      }
    </style>
  </head>
  <body>
    <section class="screen video-screen">
      <video
        id="videoLandscape"
        class="video"
        autoplay
        muted
        playsinline
        loop
        preload="auto"
        aria-label="Landscape video"
      >
        <source src="STG_flash_horizontal.mp4" type="video/mp4" />
      </video>

      <video
        id="videoPortrait"
        class="video"
        autoplay
        muted
        playsinline
        loop
        preload="auto"
        aria-label="Portrait video"
      >
        <source src="STG_flash_vertical.mp4" type="video/mp4" />
      </video>

      <div class="fallback" aria-hidden="true">
        Loading video...
      </div>
    </section>

    <section class="screen cta-screen">
      <h1>Coming 1/1/25</h1>
    </section>

    <script>
      const landscape = document.getElementById("videoLandscape");
      const portrait = document.getElementById("videoPortrait");
      const fallback = document.querySelector(".fallback");
      const samplerCanvas = document.createElement("canvas");
      const samplerCtx = samplerCanvas.getContext("2d");
      let readyVideos = 0;
      let hasInitialized = false;

      function sampleColorFromVideo(video) {
        if (!video || video.readyState < 2 || !samplerCtx) return;
        try {
          const w = video.videoWidth || 1;
          const h = video.videoHeight || 1;
          samplerCanvas.width = w;
          samplerCanvas.height = h;
          samplerCtx.drawImage(video, 0, 0, w, h);

          const size = 10;
          const x = Math.max(0, Math.floor(w / 2 - size / 2));
          const y = Math.max(0, Math.floor(h / 2 - size / 2));
          const data = samplerCtx.getImageData(x, y, size, size).data;

          let r = 0;
          let g = 0;
          let b = 0;
          let count = 0;
          for (let i = 0; i < data.length; i += 4) {
            r += data[i];
            g += data[i + 1];
            b += data[i + 2];
            count += 1;
          }
          if (count === 0) return;

          r = Math.round(r / count);
          g = Math.round(g / count);
          b = Math.round(b / count);

          document.documentElement.style.setProperty(
            "--brand-purple",
            `rgb(${r}, ${g}, ${b})`
          );
        } catch (err) {
          // ignore sampling errors
        }
      }

      function toggleVideos() {
        const useLandscape = window.innerWidth >= window.innerHeight;
        if (useLandscape) {
          landscape.classList.add("active");
          portrait.classList.remove("active");
          sampleColorFromVideo(landscape);
        } else {
          portrait.classList.add("active");
          landscape.classList.remove("active");
          sampleColorFromVideo(portrait);
        }
        if (fallback) {
          fallback.style.display = "none";
        }
      }

      function markReady(event) {
        if (readyVideos < 2) {
          readyVideos += 1;
        }
        sampleColorFromVideo(event.target);
        if (!hasInitialized && readyVideos >= 1) {
          hasInitialized = true;
          landscape.play().catch(() => {});
          portrait.play().catch(() => {});
          toggleVideos();
        }
      }

      landscape.addEventListener("canplaythrough", markReady);
      portrait.addEventListener("canplaythrough", markReady);
      landscape.addEventListener("canplay", markReady);
      portrait.addEventListener("canplay", markReady);

      window.addEventListener("resize", toggleVideos);
      window.addEventListener("orientationchange", toggleVideos);
      window.addEventListener("DOMContentLoaded", toggleVideos);
    </script>
  </body>
</html>
